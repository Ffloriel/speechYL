"use strict";function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}(),SpeechYL=function(){function t(){var n=this;_classCallCheck(this,t);var e=window.SpeechRecognition||webkitSpeechRecognition;if(!e)throw"Your browser does not support the Web Speech API";this.recognition=new e,this.synthesis=window.speechSynthesis,this.utterance=new SpeechSynthesisUtterance,this.lastTranscript="",this.synthText="",this.commands=[],this.commandsFunc=null,this.voices=this.synthesis.getVoices(),this.onresult=function(t){n.actionData(t,n.commands)},this.onvoiceschanged=function(t){n.voices=n.synthesis.getVoices()}}return _createClass(t,[{key:"setLang",value:function(t){this.synthesisLang=t,this.recognitionLang=t}},{key:"synthCancel",value:function(){this.synthesis.cancel()}},{key:"synthPause",value:function(){this.synthesis.pause()}},{key:"synthResume",value:function(){this.synthesis.resume()}},{key:"recogAbort",value:function(){this.recognition.abort()}},{key:"recogStart",value:function(){this.recognition.start()}},{key:"recogStop",value:function(){this.recognition.stop()}},{key:"speak",value:function(t){this.synthText=t,this.utterance.text=t,this.synthesis.speak(this.utterance)}},{key:"say",value:function(t){return this.synthText=t,this.utterance.text=t,this.synthesis.speak(this.utterance),this}},{key:"isWordSaid",value:function(t,n){var e=t.resultIndex;for(e;e<t.results.length;e+=1)if(this.lastTranscript=this.formatTranscript(t.results[e][0].transcript+" "),t.results[e].isFinal&&this.lastTranscript.includes(n+" "))return!0;return!1}},{key:"isSentenceSaid",value:function(t,n){var e=t.resultIndex;for(e;e<t.results.length;e+=1)if(this.lastTranscript=this.formatTranscript(t.results[e][0].transcript),t.results[e].isFinal&&this.lastTranscript===n)return!0;return!1}},{key:"saySentenceAfterRecognition",value:function(t,n,e){var i=t.resultIndex;for(i;i<t.results.length;i+=1)if(this.lastTranscript=this.formatTranscript(t.results[i][0].transcript),this.lastTranscript===n)return this.say(e),!0;return!1}},{key:"saySentenceFromData",value:function(t,n){var e=0;for(e;e<n.length;e+=1)if(t===n[e].recognition.toLowerCase())return n[e].synthesis&&""!==n[e].synthesis&&this.say(n[e].synthesis),n[e].func&&this.launchFunc(n[e].func,n[e].funcParameters),!0;return!1}},{key:"launchFunc",value:function(t,n){var e=arguments.length<=2||void 0===arguments[2]?"normal":arguments[2],i=this.commandsFunc[t.func],s=t.funcParameters,r=void 0;if("function"!=typeof i)throw"SpeechYL : function "+t.func+" not found.";s||(s=[]),"start"===e&&(r=this.lastTranscript.slice(n.length+1),s.unshift(r)),i.apply(null,s)}},{key:"getSynthesisSentence",value:function(t){var n=this.computeTotalWeight(t),e=Math.random()*n,i=0,s=0;for(s;s<t.length;s+=1)if(i+=t[s].weight,i>e)return t[s][this.utterance.lang];throw"SpeechYW : getSynthesisError."}},{key:"getFunction",value:function(t){var n=this.computeTotalWeight(t),e=Math.random()*n,i=0,s=0;for(s;s<t.length;s+=1)if(i+=t[s].weight,i>e)return t[s];throw"SpeechYW : getFunctionError."}},{key:"formatTranscript",value:function(t){return"string"!=typeof t?null:(t=t.toLowerCase()," "===t.charAt(0)&&(t=t.slice(1)),t)}},{key:"actionDataType",value:function(t,n){for(var e=arguments.length<=2||void 0===arguments[2]?"normal":arguments[2],i=void 0,s=void 0,r=void 0,o=void 0,c=void 0,a=0;a<t.results.length;a+=1)if(i=t.results[a],this.lastTranscript=this.formatTranscript(i[0].transcript),s=this.retrieveData(n,e),null!==s&&void 0!==s)return c=this.retrieveRecognitionSentence(s),r=this.retrieveSynthesis(s),null!==r&&this.say(r),o=this.retrieveFunction(s),null!==o&&this.launchFunc(o,c,e),!0;return!1}},{key:"actionData",value:function(t,n){this.actionDataType(t,n,"normal")}},{key:"actionDataStart",value:function(t,n){this.actionDataType(t,n,"start")}},{key:"actionDataInclude",value:function(t,n){this.actionDataType(t,n,"include")}},{key:"computeTotalWeight",value:function(t){var n=0,e=0;for(n;n<t.length;n+=1)e+=t[n].weight;return e}},{key:"retrieveData",value:function(t){var n=this,e=arguments.length<=1||void 0===arguments[1]?"normal":arguments[1],i=void 0;switch(e){case"normal":i=t.find(function(t){return n.lastTranscript===n.retrieveRecognitionSentence(t)});break;case"start":i=t.find(function(t){return n.lastTranscript.startsWith(n.retrieveRecognitionSentence(t))});break;case"include":i=t.find(function(t){return n.lastTranscript.includes(n.retrieveRecognitionSentence(t))});break;default:i=null}return i}},{key:"retrieveSynthesis",value:function(t){var n=null;return t.synthesis?t.synthesis instanceof Array?n=this.getSynthesisSentence(t.synthesis):t.synthesis instanceof Object?n=t.synthesis[this.utterance.lang]:"string"==typeof t.synthesis&&(n=t.synthesis):n=null,n}},{key:"retrieveFunction",value:function(t){var n=null;return t.func?t.func instanceof Array?n=this.getFunction(t.func):t.func instanceof Object?n=t.func:"string"==typeof t.func&&(n={func:t.func,funcParameters:[]}):n=null,n}},{key:"retrieveRecognitionSentence",value:function(t){var n=null;return t.recognition instanceof Object?n=t.recognition[this.recognition.lang]:"string"==typeof t.recognition&&(n=t.recognition),this.formatTranscript(n)}},{key:"getJson",value:function(t){return new Promise(function(n,e){var i=new XMLHttpRequest;i.open("Get",t),i.onload=function(){200===i.status?n(i.response):e(new Error("Data did not load successfully; Error code: "+i.statusText))},i.onerror=function(){e(new Error("Data did not load successfully; Network error."))},i.send()})}},{key:"loadJsonCommands",value:function(t){var n=this,e=void 0;this.getJson(t).then(function(t){if(e=JSON.parse(t),!(e instanceof Array))throw new TypeError("Json data must be an Array");n.commands=n.commands.concat(e)},function(t){throw t})}},{key:"getVoiceByName",value:function(t){return this.voices.find(function(n){return n.name===t})}},{key:"getVoicesByLang",value:function(t){return this.voices.filter(function(n){return n.lang===t})}},{key:"createCommands",value:function(t,n,e){return{recognition:t,synthesis:n,func:e}}},{key:"addCommand",value:function(t,n,e){this.commands.push({recognition:t,synthesis:n,func:e})}},{key:"synthesisLang",get:function(){return this.utterance.lang},set:function(t){this.utterance.lang=t}},{key:"recognitionLang",get:function(){return this.recognition.lang},set:function(t){this.recognition.lang=t}},{key:"voice",get:function(){return this.utterance.voice},set:function(t){this.utterance.voice=t}},{key:"maxAlternatives",get:function(){return this.recognition.maxAlternatives},set:function(t){this.recognition.maxAlternatives=t}},{key:"serviceURI",get:function(){return this.recognition.serviceURI},set:function(t){this.recognition.serviceURI=t}},{key:"onaudiostart",set:function(t){this.recognition.onaudiostart=t},get:function(){return this.recognition.onaudiostart}},{key:"onaudioend",set:function(t){this.recognition.onaudioend=t},get:function(){return this.recognition.onaudioend}},{key:"onend",set:function(t){this.recognition.onend=t},get:function(){return this.recognition.onend}},{key:"onerror",set:function(t){this.recognition.onerror=t},get:function(){return this.recognition.onerror}},{key:"onnomatch",set:function(t){this.recognition.onnomatch=t},get:function(){return this.recognition.onnomatch}},{key:"onresult",set:function(t){this.recognition.onresult=t},get:function(){return this.recognition.onresult}},{key:"onsoundstart",set:function(t){this.recognition.onsoundstart=t},get:function(){return this.recognition.onsoundstart}},{key:"onsoundend",set:function(t){this.recognition.onsoundend=t},get:function(){return this.recognition.onsoundend}},{key:"onspeechstart",set:function(t){this.recognition.onspeechstart=t},get:function(){return this.recognition.onspeechstart}},{key:"onspeechend",set:function(t){this.recognition.onspeechend=t},get:function(){return this.recognition.onspeechend}},{key:"onstart",set:function(t){this.recognition.onstart=t},get:function(){return this.recognition.onstart}},{key:"onvoiceschanged",set:function(t){this.synthesis.onvoiceschanged=t},get:function(){return this.synthesis.onvoiceschanged}}]),t}();